<!-- 
  This shortcode is used to embed a Meshery design into hugo sites 
  Meshery Design Embedding allows exporting a design as an interactive component 
  that integrates seamlessly into websites, blogs, or any platform supporting HTML, CSS, and JavaScript. 
  This embedded design is interactive, making it easier for infrastructure stakeholders 
  to visualize, explore, and collaborate on service mesh designs.
  
  -- Usage: 
  {{/*< meshery-design-embed src="path/to/embed.js" id="unique-id" size="full|half" link="design-url" >*/}}
  size: "full" for full-width (default), "half" for half-width display
  link: Optional URL to link to the original design. If not provided, will auto-generate from design ID
  id: Container ID, usually in format "embedded-design-<design_id>"
  
  -- Parameters:
    - src: Path to the JavaScript file for the embedded design
    - id: Full container ID (e.g., "embedded-design-7d183e77-09e1-4b69-a5ee-3e3870e9c5f4")
    - size: "full" for full-width (default), "half" for half-width display  
    - link: Optional URL to override auto-generated Meshery link

  -- Auto-link generation:
    If 'link' parameter is not provided and ID follows the pattern "embedded-design-{uuid}",
    the shortcode will automatically generate:
    https://playground.meshery.io/extension/meshmap?mode=design&design={uuid}

  More Information: 
  Learn more about embedding Meshery designs at:
  https://docs.layer5.io/kanvas/designer/embedding-designs/
-->

<!-- 
  Retrieve the path to the JavaScript file generated for embedding the Meshery design.
  This script is generated when exporting a design from kanvas.new.
  The `src` attribute specifies the script location, as provided by the user. 
-->
{{ $script := .Get "src" }}

<!-- 
  Retrieve the unique ID for the embedded Meshery design. 
  This ID is typically generated when creating the embed code and is used to uniquely 
  identify the container for the embedded design on the page.
-->
{{ $id := .Get "id" }}

<!-- 
  Retrieve the size for the embedding container.
  If not provided, "full" is used as default.
-->
{{ $size := .Get "size" | default "full" }}

<!--
  Retrieve the optional link to the original design.
  This enables hyperlink functionality for the embedded design.
-->
{{ $link := .Get "link" }}

<!-- Auto-generate link if not provided -->
{{ $autoLink := "" }}
{{ if not $Link }}
  {{ if strings.HasPrefix $id "embedded-design-" }}
    {{ $designId := strings.TrimPrefix $id "embedded-design-" }}
    {{ $autoLink = printf "https://playground.meshery.io/extension/meshmap?mode=design&design=%s" $designId }}
  {{ end }}
{{ end }}

<!-- Use custom link if provided, otherwise use auto-generated link -->
{{ $finalLink := $Link }}
{{ if not $finalLink }}
  {{ $finalLink = $autoLink }}
{{ end }}

<style>
.meshery-embed-container {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  margin: 1rem auto;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  position: relative;
  transition: all 0.3s ease;
  aspect-ratio: 4 / 3;
}
.meshery-embed-container.full {
  width: 100%;
}
.meshery-embed-container.half {
  width: 50%;
}
@media (max-width: 768px) {
  .meshery-embed-container.half {
    width: 70%;
  }
}
.meshery-embed-container .cy-container {
  width: 100%;
  height: 100%;
  border-radius: 11px;
}
</style>

{{ if $link }}
<style>
.meshery-embed-container {
  cursor: pointer;
}
.meshery-embed-container:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
  border-color: rgba(0, 179, 159, 0.5);
  background: rgba(255, 255, 255, 0.15);
}
.meshery-embed-container::after {
  content: "ðŸ”— Open in Meshery";
  position: absolute;
  top: 12px;
  right: 12px;
  background: rgba(0, 179, 159, 0.9);
  color: white;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 500;
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
}
.meshery-embed-container:hover::after {
  opacity: 1;
}
</style>
{{ end }}

<!-- 
  Embedding Container: 
  A `div` element is dynamically created with the provided or default styles. 
  - The `id` attribute links to the unique design embed.
  - The `style` attribute can be customized or fall back to a default appearance, 
    which includes:
      - Height: 30rem
      - Width: 100% (responsive to container width)
      - Border: 1px solid #eee (light border for visibility)
-->

{{ if $link }}
<a href="{{ $link }}" target="_blank" rel="noopener" style="text-decoration: none; color: inherit;">
{{ end }}
<div
    id="{{ $id }}"
    class="meshery-embed-container {{ $size }}"
></div>
{{ if $link }}
</a>
{{ end }}

<!-- 
  Embed Script: 
  The JavaScript file (retrieved from the `src` attribute) is included here.
  - The `type="module"` ensures the script runs in a modern ES6 module context.
-->
<script src="{{ $script }}" type="module"></script>
